<!DOCTYPE html>
<html lang="sr">
<head>
  <meta charset="UTF-8" />
  <title>Zakazivanje Slikanja</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #eef1f5;
      padding: 20px;
    }
    h1 {
      text-align: center;
    }
    .selector {
      text-align: center;
      margin-bottom: 15px;
    }
    #pretragaSifre {
      display: block;
      margin: 0 auto 15px auto;
      padding: 8px;
      font-size: 14px;
      width: 200px;
      border-radius: 6px;
      border: 1px solid #ccc;
      text-align: center;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 15px;
      max-width: 1200px;
      margin: auto;
    }
    .slot {
      background: #fff;
      border: 1px solid #ccc;
      padding: 10px;
      border-radius: 6px;
    }
    .slot.filled {
      background: #dff0d8;
    }
    .slot h4 {
      text-align: center;
      margin-top: 0;
    }
    .slot input {
      width: 100%;
      padding: 5px;
      margin-bottom: 5px;
      box-sizing: border-box;
    }
    .checkbox {
      display: flex;
      align-items: center;
      gap: 5px;
    }
  </style>
</head>
<body>
  <h1>Zakazivanje Slikanja</h1>
  <input id="pretragaSifre" type="text" placeholder="Pretraga po šifri" oninput="pretraziSifru()" />
  <div class="selector">
    <label for="datum">Izaberi datum:</label>
    <input type="date" id="datum" onchange="prikaziTermine()">
  </div>
  <div class="grid" id="terminiGrid"></div>

  <script>
    const SHEET_URL = "https://script.googleusercontent.com/macros/echo?user_content_key=AehSKLgoUOahSLvetiMiKxtOIDBL7mgTOBFiw6yUic9bcxqnN3ILyyB9iFHHgXiP9sm52RVtr4E-GxN9RAEjJJD03lbYDj-UYTH4ofslij2uXF8O3eprQqapoaypDJ-etCVOn8hk0VVKPOJFgeJFSUHmgGloaEiB_l-c987-2KMLUB2H6_0WOAfQGhP1t8hJDuME4dG_E5XaUWRtaqltKJZsOWRFWJVEnFQNP1nNCRap8U84jxZo88eSDeZzMi8NpaSydWem8bnqtfHBvJSYBhThFlEtgr-mWelNBGsqwzxA&lib=MIPm2ju-ijGXWi5xgI7G-NI5etRJWauVd";

    const startTime = 9;
    const endTime = 19;
    const interval = 30;

    function danasnjiDatum() {
      const d = new Date();
      const offset = d.getTimezoneOffset() / -60;
      d.setHours(d.getHours() + offset);
      return d.toISOString().split("T")[0];
    }

    document.getElementById("datum").value = danasnjiDatum();

    function generisiTermine() {
      const termini = [];
      for (let h = startTime; h <= endTime; h++) {
        for (let m = 0; m < 60; m += interval) {
          termini.push(`${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}`);
        }
      }
      return termini;
    }

    function prikaziTermine() {
      const grid = document.getElementById("terminiGrid");
      grid.innerHTML = "";
      const datum = document.getElementById("datum").value;
      const termini = generisiTermine();

      termini.forEach(vreme => {
        const slot = document.createElement("div");
        slot.className = "slot";
        const h4 = document.createElement("h4");
        h4.textContent = vreme;
        slot.appendChild(h4);

        const sifra = napraviInput("Šifra stana");
        const agent = napraviInput("Agent");
        const adresa = napraviInput("Adresa");
        const telefon = napraviInput("Telefon");

        const checkDiv = document.createElement("div");
        checkDiv.className = "checkbox";
        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        const label = document.createElement("label");
        label.textContent = "Slikano";
        checkDiv.appendChild(checkbox);
        checkDiv.appendChild(label);

        slot.appendChild(sifra);
        slot.appendChild(agent);
        slot.appendChild(adresa);
        slot.appendChild(telefon);
        slot.appendChild(checkDiv);

        [sifra, agent, adresa, telefon, checkbox].forEach(el => {
          el.addEventListener("input", () => {
            if (sifra.value.trim() !== "") slot.classList.add("filled");
            sacuvajTermin(datum, vreme, sifra.value, agent.value, adresa.value, telefon.value, checkbox.checked);
          });
        });

        slot.dataset.sifra = sifra.value;
        grid.appendChild(slot);
      });
    }

    function napraviInput(placeholder) {
      const input = document.createElement("input");
      input.placeholder = placeholder;
      return input;
    }

    function sacuvajTermin(datum, vreme, sifra, agent, adresa, telefon, slikano) {
      const params = new URLSearchParams({
        datum,
        termin: vreme,
        sifraStana: sifra,
        agent,
        adresa,
        telefon,
        slikano: slikano.toString(),
        callback: "callbackFunkcija"
      });

      const script = document.createElement("script");
      script.src = SHEET_URL + "?" + params.toString();
      document.body.appendChild(script);

      window.callbackFunkcija = function(res) {
        console.log("Sačuvano:", res);
        document.body.removeChild(script);
        delete window.callbackFunkcija;
      };
    }

    function pretraziSifru() {
      const query = document.getElementById("pretragaSifre").value.trim().toLowerCase();
      const sviSlotovi = document.querySelectorAll(".slot");
      sviSlotovi.forEach(slot => {
        const sifraInput = slot.querySelector("input[placeholder='Šifra stana']");
        const val = sifraInput.value.trim().toLowerCase();
        slot.style.display = val.includes(query) ? "block" : "none";
      });
    }

    prikaziTermine();
  </script>
</body>
</html>


