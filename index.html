<!DOCTYPE html>
<html lang="sr">
<head>
  <meta charset="UTF-8">
  <title>Zakazivanje slikanja</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    .slot { border: 1px solid #ccc; padding: 10px; margin: 5px; display: inline-block; width: 180px; }
    .slot input[type="checkbox"] { margin-top: 5px; }
  </style>
</head>
<body>
  <h1>Zakazivanje slikanja</h1>
  <label>Datum: <input type="date" id="datum" /></label>
  <button onclick="loadTermini()">Učitaj termine</button>

  <div id="terminiGrid"></div>
  <button onclick="sacuvaj()">Sačuvaj sve</button>

  <script>
    const termini = [
      "09:00", "09:30", "10:00", "10:30",
      "11:00", "11:30", "12:00", "12:30",
      "13:00", "13:30", "14:00", "14:30",
      "15:00", "15:30", "16:00", "16:30",
      "17:00", "17:30", "18:00", "18:30",
      "19:00", "19:30"
    ];

    let stanja = {};

    function renderGrid(podatak) {
      const grid = document.getElementById("terminiGrid");
      grid.innerHTML = "";

      termini.forEach(termin => {
        const info = podatak.find(p => p.termin === termin) || {};
        stanja[termin] = info;

        const div = document.createElement("div");
        div.className = "slot";
        div.innerHTML = `
          <strong>${termin}</strong><br/>
          Šifra: <input value="${info.sifraStana || ''}" onchange="azuriraj('${termin}', 'sifraStana', this.value)" /><br/>
          Agent: <input value="${info.agent || ''}" onchange="azuriraj('${termin}', 'agent', this.value)" /><br/>
          Adresa: <input value="${info.adresa || ''}" onchange="azuriraj('${termin}', 'adresa', this.value)" /><br/>
          Tel: <input value="${info.telefon || ''}" onchange="azuriraj('${termin}', 'telefon', this.value)" /><br/>
          Slikano: <input type="checkbox" ${info.slikano ? 'checked' : ''} onchange="azuriraj('${termin}', 'slikano', this.checked)" />
        `;
        grid.appendChild(div);
      });
    }

    function azuriraj(termin, polje, vrednost) {
      if (!stanja[termin]) stanja[termin] = { termin };
      stanja[termin][polje] = vrednost;
    }

    function sacuvaj() {
      const datum = document.getElementById("datum").value;
      if (!datum) return alert("Unesi datum!");

      Object.keys(stanja).forEach(termin => {
        const podatak = stanja[termin];
        if (podatak.sifraStana || podatak.agent || podatak.adresa || podatak.telefon || podatak.slikano) {
          const params = new URLSearchParams({
            datum: datum,
            termin: termin,
            sifraStana: podatak.sifraStana || "",
            agent: podatak.agent || "",
            adresa: podatak.adresa || "",
            telefon: podatak.telefon || "",
            slikano: podatak.slikano ? "true" : "false",
            callback: "callback"
          });

          const url = 'https://script.google.com/macros/s/AKfycbx4jchhNosP2vCpL0RV46fOqVX4LWCnVrXLkXIMyi7YIkw0NHxyfChO0HqyFbk480K7Yw/exec?' + params.toString();

          const script = document.createElement("script");
          script.src = url;
          document.body.appendChild(script);
        }
      });

      alert("Sačuvano!");
    }

    function loadTermini() {
      const datum = document.getElementById("datum").value;
      if (!datum) return alert("Unesi datum!");

      const url = `https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec?action=load&datum=${datum}&callback=ucitaj`;

      const script = document.createElement("script");
      script.src = url.replace('action=load', 'callback=ucitaj');
      document.body.appendChild(script);
    }

    function ucitaj(data) {
      const datum = document.getElementById("datum").value;
      const filtrirano = data.filter(x => x.datum === datum);
      renderGrid(filtrirano);
    }
  </script>
</body>
</html>
