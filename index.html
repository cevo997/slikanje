<!DOCTYPE html>
<html lang="sr">
<head>
<meta charset="UTF-8" />
<title>Zakazivanje slikanja</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 600px; margin: 20px auto; }
  label { display: block; margin-top: 10px; }
  input, select { width: 100%; padding: 8px; margin-top: 4px; }
  button { margin-top: 15px; padding: 10px 20px; cursor: pointer; }
</style>
</head>
<body>

<h1>Zakazivanje termina za slikanje</h1>

<form id="formaTermin">
  <label for="datum">Datum:</label>
  <input type="date" id="datum" required />

  <label for="termin">Izaberi termin:</label>
  <select id="termin" required></select>

  <label for="sifraStana">Šifra stana:</label>
  <input type="text" id="sifraStana" required />

  <label for="agent">Agent:</label>
  <input type="text" id="agent" required />

  <label for="adresa">Adresa:</label>
  <input type="text" id="adresa" required />

  <label for="telefon">Broj telefona:</label>
  <input type="tel" id="telefon" required pattern="[0-9+\-\s]+" />

  <label><input type="checkbox" id="slikano" /> Slikano</label>

  <button type="submit">Sačuvaj termin</button>
</form>

<script>
  // Popuni termine od 09:00 do 19:30 u 30 min koracima
  function napraviTermine() {
    const termini = [];
    const start = new Date();
    start.setHours(9,0,0,0);
    const end = new Date();
    end.setHours(19,30,0,0);
    let trenutni = new Date(start);
    while (trenutni <= end) {
      const h = trenutni.getHours().toString().padStart(2,'0');
      const m = trenutni.getMinutes().toString().padStart(2,'0');
      termini.push(`${h}:${m}`);
      trenutni.setMinutes(trenutni.getMinutes() + 30);
    }
    return termini;
  }

  const selectTermin = document.getElementById('termin');
  const datumInput = document.getElementById('datum');

  // Postavi danasnji datum kao default u input type=date
  function setujDanasnjiDatum() {
    const danas = new Date();
    const yyyy = danas.getFullYear();
    const mm = (danas.getMonth()+1).toString().padStart(2,'0');
    const dd = danas.getDate().toString().padStart(2,'0');
    datumInput.value = `${yyyy}-${mm}-${dd}`;
  }

  // Popuni dropdown sa terminima
  function popuniTermine() {
    const termini = napraviTermine();
    termini.forEach(t => {
      const option = document.createElement('option');
      option.value = t;
      option.textContent = t;
      selectTermin.appendChild(option);
    });
  }

  // Funkcija za slanje podataka u Google Apps Script Web App
  async function posaljiTermin(terminData) {
    const url = 'https://script.google.com/macros/s/AKfycbwGT7RoHLhEZ1VRgecAN-gBu5WNuJA9hpzKuB5q4W0GWc3bkt2Fw3-7qc7oP4SP-TvNXQ/exec';

    const response = await fetch(url, {
      method: 'POST',
      body: JSON.stringify(terminData),
      headers: {
        'Content-Type': 'application/json'
      }
    });

    const result = await response.json();
    return result;
  }

  const forma = document.getElementById('formaTermin');
  forma.addEventListener('submit', async e => {
    e.preventDefault();

    const terminData = {
      datum: datumInput.value,
      termin: selectTermin.value,
      sifraStana: document.getElementById('sifraStana').value.trim(),
      agent: document.getElementById('agent').value.trim(),
      adresa: document.getElementById('adresa').value.trim(),
      telefon: document.getElementById('telefon').value.trim(),
      slikano: document.getElementById('slikano').checked
    };

    try {
      const rezultat = await posaljiTermin(terminData);
      if (rezultat.status === 'success') {
        alert('Termin uspešno dodat!');
        forma.reset();
        setujDanasnjiDatum();
      } else {
        alert('Greška: ' + rezultat.message);
      }
    } catch (err) {
      alert('Greška u komunikaciji: ' + err.message);
    }
  });

  // Init
  popuniTermine();
  setujDanasnjiDatum();
</script>

</body>
</html>
