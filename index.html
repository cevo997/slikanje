<!DOCTYPE html>
<html lang="sr">
<head>
<meta charset="UTF-8" />
<title>Zakazivanje slikanja</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 600px; margin: 20px auto; }
  label { display: block; margin-top: 10px; }
  input, select { width: 100%; padding: 8px; margin-top: 4px; }
  button { margin-top: 10px; padding: 10px 20px; }
  table { width: 100%; margin-top: 20px; border-collapse: collapse; }
  th, td { border: 1px solid #ccc; padding: 6px; text-align: left; }
  th { background: #eee; }
</style>
</head>
<body>

<h1>Zakazivanje termina za slikanje</h1>

<div>
  <button id="btnPrethodni">Prethodni dan</button>
  <span id="datumTekst" style="font-weight:bold; margin: 0 10px;"></span>
  <button id="btnSledeci">Sledeći dan</button>
</div>

<form id="formaTermin">
  <label for="termin">Izaberi termin:</label>
  <select id="termin"></select>

  <label for="sifraStana">Šifra stana:</label>
  <input type="text" id="sifraStana" required />

  <label for="agent">Agent:</label>
  <input type="text" id="agent" required />

  <label for="adresa">Adresa:</label>
  <input type="text" id="adresa" required />

  <label for="telefon">Broj telefona:</label>
  <input type="tel" id="telefon" required pattern="[0-9+\-\s]+" />

  <label><input type="checkbox" id="slikano" /> Slikano</label>

  <button type="submit">Sačuvaj termin</button>
</form>

<h2>Zakazani termini za izabrani dan</h2>
<table id="tabelaTermina">
  <thead>
    <tr><th>Termin</th><th>Šifra stana</th><th>Agent</th><th>Adresa</th><th>Telefon</th><th>Slikano</th></tr>
  </thead>
  <tbody></tbody>
</table>

<script>
  // Pomoćna funkcija za format datuma (dd.mm.yyyy)
  function formatDatum(date) {
    return date.toLocaleDateString('sr-RS');
  }

  // Kreiraj liste termina od 9:00 do 19:30 u 30min koracima
  function napraviTermine() {
    const termini = [];
    const start = new Date();
    start.setHours(9,0,0,0);
    const end = new Date();
    end.setHours(19,30,0,0);
    let trenutni = new Date(start);
    while (trenutni <= end) {
      let h = trenutni.getHours().toString().padStart(2,'0');
      let m = trenutni.getMinutes().toString().padStart(2,'0');
      termini.push(`${h}:${m}`);
      trenutni.setMinutes(trenutni.getMinutes() + 30);
    }
    return termini;
  }

  // Inicijalizacija
  let izabraniDatum = new Date();

  const datumTekstEl = document.getElementById('datumTekst');
  const btnPrethodni = document.getElementById('btnPrethodni');
  const btnSledeci = document.getElementById('btnSledeci');
  const selectTermin = document.getElementById('termin');
  const forma = document.getElementById('formaTermin');
  const tabelaBody = document.querySelector('#tabelaTermina tbody');

  // Popuni dropdown sa terminima
  function popuniTermine() {
    selectTermin.innerHTML = '';
    const termini = napraviTermine();
    termini.forEach(t => {
      const option = document.createElement('option');
      option.value = t;
      option.textContent = t;
      selectTermin.appendChild(option);
    });
  }

  // Prikazi datum
  function prikaziDatum() {
    datumTekstEl.textContent = formatDatum(izabraniDatum);
  }

  // Ucitaj termine za datum iz baze (ovde simulirano sa localStorage)
  function ucitajTermine() {
    tabelaBody.innerHTML = '';
    const kljuc = 'termini_' + izabraniDatum.toISOString().slice(0,10);
    const podaci = JSON.parse(localStorage.getItem(kljuc)) || [];

    podaci.forEach(term => {
      const red = document.createElement('tr');
      red.innerHTML = `
        <td>${term.termin}</td>
        <td>${term.sifraStana}</td>
        <td>${term.agent}</td>
        <td>${term.adresa}</td>
        <td>${term.telefon}</td>
        <td>${term.slikano ? 'Da' : 'Ne'}</td>
      `;
      tabelaBody.appendChild(red);
    });
  }

  // Sacuvaj termin u localStorage (ovde bi isla logika za backend)
  function sacuvajTermin(term) {
    const kljuc = 'termini_' + izabraniDatum.toISOString().slice(0,10);
    const podaci = JSON.parse(localStorage.getItem(kljuc)) || [];
    podaci.push(term);
    localStorage.setItem(kljuc, JSON.stringify(podaci));
  }

  // Dodaj event za formu
  forma.addEventListener('submit', e => {
    e.preventDefault();

    const term = {
      termin: selectTermin.value,
      sifraStana: document.getElementById('sifraStana').value.trim(),
      agent: document.getElementById('agent').value.trim(),
      adresa: document.getElementById('adresa').value.trim(),
      telefon: document.getElementById('telefon').value.trim(),
      slikano: document.getElementById('slikano').checked
    };

    sacuvajTermin(term);
    ucitajTermine();

    forma.reset();
  });

  btnPrethodni.addEventListener('click', () => {
    izabraniDatum.setDate(izabraniDatum.getDate() - 1);
    prikaziDatum();
    ucitajTermine();
  });

  btnSledeci.addEventListener('click', () => {
    izabraniDatum.setDate(izabraniDatum.getDate() + 1);
    prikaziDatum();
    ucitajTermine();
  });

  // Inicijalizacija stranice
  popuniTermine();
  prikaziDatum();
  ucitajTermine();

</script>

</body>
</html>
